<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="content-type"><title>Résultats chronoHB en ligne</title>
<link rel="stylesheet" type="text/css" href="mystyleWeb.css"></link>
<!--- <script src="jquery-3.6.0.min.js"> integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous">
</script>--->
</head>
<body>


    <div class=tabs >
     <div id=tab1 > <a href="#tab1">12 km</a>
	  <div>
		  <h2> Catégorie 12 km <span id='chronotime0'></span></h2>
		  <div id="conteneurGlobal0" >
		  </div>
	  </div>
     </div>

     <div id=tab2> <a href="#tab2">8 km</a>
	  <div>
			<h2> Catégorie 8 km <span id='chronotime1'></span></h2>
		  <div id="conteneurGlobal1" >
		  </div>
     </div>
    </div>
   </div>
  

<!---
<div id="ErreurMessage" style="display:none" ><h1> Le serveur chronoHB est injoignable : problème réseau problable...<br>Cette page se rétablira quand le serveur sera joignable.</h1></div>


<!---  src="Affichage-Contenu.html" style="border: 0; width: 100%; height: 100%" --->

<script src="jquery-3.6.0.js"></script>

<!---
<script>
//var contenuNormal = '<iframe id="conteneurGlobal" class="fullScreen" src="Affichage-Contenu.html" style="border: 0; width: 100%; height: 100%"></iframe>';
//var contenuErreur = "";
//var testDataOld = false;
function reCharger() {
	document.getElementById('conteneurGlobal').innerHTML = "";
	$("#conteneurGlobal").load("Affichage-Contenu.html") ;
}

function testChargement() {
	//console.log("testChargementdébut");
	var testData = !!document.getElementById("testCharge");
	//console.log(testData);
	if (! testData) {// si la page ne s'est pas chargée correctement.
		document.getElementById('ErreurMessage').style.display = "block" ;
		reCharger()
		console.log("nouvelle tentative de chargement de la page car serveur absent");
		document.getElementById('conteneurGlobal').style.display = "none" ;
		//document.getElementById('conteneurGlobal').style.display = "none" ;
	} 	else { // si la page s'est chargée correctement.
		//if ( ! testDataOld) {// si la page était préalablement mal chargée
			//console.log("on ne fait rien : tout est ok.");
			document.getElementById('ErreurMessage').style.display = "none" ;
			//document.getElementById('conteneurGlobal').className = "fullScreen" ;
			document.getElementById('conteneurGlobal').style.display = "block";
		//}
	}
	var t5 = setTimeout("testChargement();", 2000);
	//var testDataOld = testData ;
	//document.getElementById("conteneurGlobal").className = "fullScreen";
	//document.getElementById('conteneurGlobal').style.height = window.innerHeight;
	}
--->

<script async>
function MAJ(i) {
	$("#conteneurGlobal1").load("Affichage-tab" + i.toString() + ".html") ;
}



var chronometres = [[2023, 1, 7, 17, 0, 9, 0], [2023, 1, 7, 17, 0, 9, 0]];// liste de longueur le nombre d'onglets à afficher.
var timerID = [0,0]; // liste de longueur le nombre d'onglets à afficher.
//var chronometres = [,]; // liste de longueur le nombre d'onglets à afficher.
var startTime = 0 ;
var start = 0 ;
var end = 0 ;
var diff = 0 ;
var timerID = 0 ;

function changeTimeZone(date, ianatz) {
  // suppose the date is 12:00 UTC
  var invdate = new Date(date.toLocaleString('en-US', {
    timeZone: ianatz
  }));
  var diff = date.getTime() - invdate.getTime();
  // so 12:00 in Toronto is 17:00 UTC
  return new Date(date.getTime() - diff); // needs to substract
}

function chrono(i){
				start = new Date(chronometres[i][0],chronometres[i][1],chronometres[i][2],chronometres[i][3],chronometres[i][4],chronometres[i][5]);
				end = changeTimeZone(new Date(), 'Europe/London');
                diff = end - start ;
                diff = new Date(diff) ;
                var msec = diff.getMilliseconds() ;
                var sec = diff.getSeconds() ;
                var min = diff.getMinutes() ;
                var hr = diff.getHours()-1 ;
                if (min < 10){
                        min = "0" + min ;
                }
                if (sec < 10){
                        sec = "0" + sec ;
                }
				// A décommenter plus tard pour la production
				//if (start.getDay() == end.getDay() && start.getMonth() == end.getMonth() && start.getYear() == end.getYear()) {
					document.getElementById("chronotime" + i.toString()).innerHTML = "(" + hr + ":" + min + ":" + sec + ")" ;
					timerIDbis = setTimeout("chrono(" + i.toString() + ")", 900) ;
				//} else {
				//	document.getElementById("chronotime" + i.toString()).innerHTML = "" ;
				//}
        }
		
function chronoStart(i){
                //clearTimeout(timerID) ;
                //console.debug(chronometres[i][0])
				var idChrono = "chronotime"+ i.toString() ;
                if (chronometres[i][0] == 0) {
                    // c'est une course qui n'a pas commencé
                    document.getElementById(idChrono).innerHTML = "00:00:00";
					document.getElementById(idChrono).style.display = "line" ;
                }
                else {
                    if (chronometres[i][0] == 1) {
                        // c'est un challenge
						document.getElementById(idChrono).style.display = "none" ;
                        document.getElementById(idChrono).innerHTML = "";
                    }
                    else {
						//start = changeTimeZone(start, 'UTC');
						//console.debug(idChrono);
						document.getElementById(idChrono).style.display = "line" ;
                        chrono(i);
                    }
                }
        }

var dureeActualisation = 10000 ; // au début 10 s puis cela varie en fonction du contexte.

function chargerStart(i){
	console.debug("chargerStart(" + i.toString() + ")")
	$("#conteneurGlobal"+i.toString()).load("Affichage-tab"+i.toString()+".html") ;
	// si c'est une course qui n'a pas commencé (et ce n'est pas un challenge)
	if (chronometres[i][0] == 0) {
		// on double le temps d'actualisation avec un maximum de 3 minutes.
		dureeActualisation = Math.min(180000,dureeActualisation*2);
	} else {
		// la course a commencé, on augmente la fréquence d'actualisation tant que personne n'est arrivé
		dureeActualisation = Math.max(5000,dureeActualisation/2);
		// sinon (si des arrivées), on diminue la fréquence d'actualisation jusqu'à 5 minutes.
	}
	// la durée devrait augmenter jusqu'à 5 minutes si la course a commencé et si aucune nouveauté depuis la dernière maj
	// si course commencée et des arrivées régulières, on diminue jusqu'à 
	// elle devrait diminuer jusqu'à 5 secondes si course commencée et pas d'arrivée (pour afficher rapidement le temps du premier, quand disponible.
	// elle doit diminuer jusqu'à 3 min minimum si course non commencée.
	timerID[i] = setTimeout("chargerStart(" + i.toString() + ")", 10000) ;
}



function lanceTout(){
	var i = 0 ;
	for (var item in chronometres) {
			chargerStart(i)
			chronoStart(i);
			i += 1 ;
		}
	}


//$("#conteneurGlobal0").load("Affichage-tab0.html") ;

//$("#conteneurGlobal1").load("Affichage-tab1.html") ;



//$("#conteneurGlobal").load("Affichage-Contenu.html") ;

// var t5 = setTimeout("testChargement();", 2000);

//var t5 = setTimeout("testMAJ();", 10000);

lanceTout();

</script>
</body></html>