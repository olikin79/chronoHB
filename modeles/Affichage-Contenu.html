<html>
<head>
</head>
<body>
<div id="titrePage" align="center">
<h2>Catégorie vide </h2>
</div>
<br>
<div class="marquee-titre" id="marquee-titre" >
	<table border="1" cellpadding="6" cellspacing="5" id="titres" >          <thead>            <tr>              <th class="first">               Place       </th>              <th class="second">                <div>NOM Prénom</div>              </th>              <th class="third">                <div>Temps</div>              </th>            </tr>          </thead>		  </table>
</div>
<div class="marquee-rtl">
    <!-- le contenu défilant -->
    <div id="conteneur" class="conteneur run-animation">
	<table border='1' cellpadding='6' cellspacing='5' id='resultats'></table>
    </div>		
</div>
<script>
var pauseEntreDeuxPages = @@tempsPause@@;
var i = 0;
var titres = @@TitresHTML@@;
var enTetes = @@EnTetesHTML@@;
var contenus = @@TableauxHTML@@;
var chronometres = @@heuresDeparts@@;
var startTime = 0 ;
var start = 0 ;
var end = 0 ;
var diff = 0 ;
var timerID = 0 ;
function chrono(){
                end = new Date() ;
                diff = end - start ;
                diff = new Date(diff) ;
                var msec = diff.getMilliseconds() ;
                var sec = diff.getSeconds() ;
                var min = diff.getMinutes() ;
                var hr = diff.getHours()-1 ;
                if (min < 10){
                        min = "0" + min ;
                }
                if (sec < 10){
                        sec = "0" + sec ;
                }

                document.getElementById("chronotime").innerHTML = hr + ":" + min + ":" + sec ;
                timerID = setTimeout("chrono()", 500) ;
        }
function chronoStart(i){
                clearTimeout(timerID) ;
                //console.debug(chronometres[i][0])
                if (chronometres[i][0] == 0) {
                    // c'est une course qui n'a pas commencé
                    document.getElementById("chronotime").innerHTML = "00:00:00";
					document.getElementById("chronotime").style.display = "line" ;
                }
                else {
                    if (chronometres[i][0] == 1) {
                        // c'est un challenge
						document.getElementById("chronotime").style.display = "none" ;
                        document.getElementById("chronotime").innerHTML = "";
                    }
                    else {
                        start = new Date(chronometres[i][0],chronometres[i][1],chronometres[i][2],chronometres[i][3],chronometres[i][4],chronometres[i][5]);
						document.getElementById("chronotime").style.display = "line" ;
                        chrono();
                    }
                }
        }
function changeContenus(i) {
	//console.log("entrée dans changeContenus()");
	var elm = document.getElementById("conteneur");
	var newone = elm.cloneNode(true);
	elm.parentNode.replaceChild(newone, elm);
	document.head.classList.add("defilement-rtl");
	if (contenus.length == 0) {
		var t4 = setTimeout("reCharger();", 10000);
		console.log("on recharge le contenu dans 10 s");
		document.getElementById("titrePage").innerHTML = "<h1>chronoHB : aucun affichage de course paramétré pour l'instant.<br>Voir avec les responsables de l'ordinateur.<br>Ne plus rien toucher et mettre en plein écran avec F11</h1>";
		document.getElementById("conteneur").innerHTML = "";
		document.getElementById("marquee-titre").innerHTML ="";
	}
	else { 
        if (i >= contenus.length) {
			//document.location.reload(true);
			reCharger();
			//console.log("on recharge le contenu car on a atteint la fin des actions programmées");
        } else {
			if (contenus.length > 0) {
				document.getElementById("conteneur").innerHTML = contenus[i];
				document.getElementById("marquee-titre").innerHTML = enTetes[i];
				document.getElementById("titrePage").innerHTML = titres[i];	
				var elmnt = document.getElementById("resultats");
				var conteneur = document.getElementById("conteneur");
				var difference = elmnt.offsetHeight - conteneur.offsetHeight ;
				chronoStart(i)
				i += 1 ;
				if (difference < 0) {
				// Pas d'animation et donc d'event de fin : on fixe un délai arbitraire de pauseEntreDeuxPages s avant pssage au tableau suivant.
					difference = 0;
					var t3 = setTimeout(changeContenus, pauseEntreDeuxPages * 1000, i);
				} else {
					var temps = (difference *3 /(@@vitesseDefilement@@*50)) ;
					//txt += "Temps défilement : " + temps + " s<br>";
					//document.getElementById("demo").innerHTML = txt;
					var style = document.createElement("style");
					 style.innerHTML="@keyframes defilement-rtl {0%  {left: 0px; top: 0px;} 49% {left: 0px; top: -"+difference+"px;} 52% {left: 0px; top: -"+difference+"px;} 100% {left: 0px; top: 0px;}}" +
			  ".marquee-rtl > :first-child {animation: defilement-rtl " + temps +"s reverse ease running;} .marquee-rtl > :first-child {animation-delay : "+ pauseEntreDeuxPages +"s;}";
					 //WebKit Hack
					 style.appendChild(document.createTextNode(""));
					 // Add the <style> element to the page
					 document.head.appendChild(style);		
					var t3 = setTimeout(changeContenus, (temps+pauseEntreDeuxPages)*1000+ 2000, i);
					return style.sheet;
				}
			}
		}
	}
};
window.onload = function() {
  var t1 = changeContenus(0) ;
};
//var t4 = setTimeout(changeContenus, 30, i);
changeContenus(0);
</script>
<div id="testCharge"></div>
</body></html>
